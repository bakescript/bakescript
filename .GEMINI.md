# Governança de Código - Regras Obrigatórias

## Contexto

Este projeto segue um conjunto rigoroso de regras de qualidade de código documentadas na pasta `.rules/`. Cada regra é categorizada, possui critérios objetivos mensuráveis e severidade definida. Você DEVE seguir todas as regras ao escrever, revisar ou sugerir código.

## Localização das Regras

- **Repositório**: `.rules/`
- **Formato**: `[NNN]_[nome-da-regra].md`
- **Estrutura**: Cada regra contém ID, severidade, categoria, critérios objetivos, exceções e detecção

## Instruções de Comportamento

### 1. Leitura Automática de Regras

Quando você receber solicitações de código, SEMPRE:

1. **Liste** todos os arquivos em `.rules/`
2. **Leia** cada arquivo de regra para entender:
   - ID e categoria (Criacional/Comportamental/Estrutural)
   - Severidade (🔴 Crítica / 🟠 Alta / 🟡 Média / 🟢 Baixa)
   - Critérios objetivos mensuráveis
   - Exceções permitidas
3. **Aplique** as regras ao código que você criar ou revisar
4. **Priorize** por severidade: 🔴 → 🟠 → 🟡 → 🟢

### 2. Criação de Código

Ao escrever código, você deve:

✅ **Seguir TODAS as regras por padrão**
- Verifique cada critério objetivo das regras aplicáveis
- Respeite limites numéricos (linhas, parâmetros, complexidade)
- Aplique padrões estruturais definidos

✅ **Documentar exceções justificadas**
- Se violar uma regra, cite o ID da regra
- Explique qual exceção permitida você está usando
- Adicione comentário no código: `// REGRA [ID]: [justificativa]`

✅ **Validar antes de retornar**
- Faça uma checklist mental de todas as regras 🔴 Críticas
- Verifique regras 🟠 Altas relacionadas ao código
- Mencione quais regras você seguiu

❌ **NUNCA faça**:
- Ignorar regras silenciosamente
- Violar regras 🔴 Críticas sem justificativa explícita
- Criar código que não passa nos critérios objetivos
- Sugerir soluções que claramente violam múltiplas regras

### 3. Revisão de Código

Quando revisar código existente ou fornecido pelo usuário:

1. **Análise sistemática**:
   ```
   Para cada arquivo/função:
   ├─ Identificar regras aplicáveis (por categoria)
   ├─ Verificar critérios objetivos
   ├─ Detectar violações
   └─ Classificar por severidade
   ```

2. **Formato de reporte**:
   ```markdown
   ## 🔍 Análise de Conformidade

   ### ✅ Regras Seguidas
   - [ID-REGRA]: [Nome da regra]

   ### ⚠️ Violações Detectadas

   #### 🔴 Críticas
   - **[ID-REGRA]**: [Nome]
     - Localização: [arquivo:linha]
     - Critério violado: [qual critério objetivo]
     - Sugestão: [como corrigir]

   #### 🟠 Altas
   [mesmo formato]

   #### 🟡 Médias
   [mesmo formato]

   ### 💡 Recomendações
   [Melhorias opcionais baseadas em regras 🟢 Baixas]
   ```

3. **Priorização de correções**:
   - Bloquear merge em violações 🔴 Críticas
   - Requerer correção de 🟠 Altas
   - Sugerir correção de 🟡 Médias
   - Mencionar 🟢 Baixas como melhorias futuras

### 4. Explicações e Ensino

Quando explicar conceitos de código:

- **Cite regras relevantes**: "Segundo a regra [ID] ([Nome]), devemos..."
- **Use critérios objetivos**: Cite números/limites das regras
- **Reforce princípios**: Conecte regras aos princípios SOLID/Clean Code
- **Mostre exemplos**: ❌ Violação vs ✅ Conformidade

### 5. Refatoração

Ao sugerir refatorações:

1. Identifique quais regras o código atual viola
2. Proponha solução que resolva TODAS as violações
3. Liste regras que a refatoração atende
4. Verifique se não introduz novas violações

**Template de refatoração**:
```markdown
## 🔧 Refatoração Proposta

### Problema
Código atual viola:
- [ID-1]: [critério específico]
- [ID-2]: [critério específico]

### Solução
[código refatorado]

### Conformidade
✅ Agora atende:
- [ID-1]: [como resolve]
- [ID-2]: [como resolve]
- [ID-3]: [regra adicional que passou a seguir]

### Trade-offs
[Se houver, explique com base em exceções permitidas]
```

## Hierarquia de Prioridade

Em caso de conflito ou dúvida, siga esta ordem:

1. **Regras 🔴 Críticas** - Invioláveis (exceto exceções documentadas)
2. **Regras 🟠 Altas** - Fortemente recomendadas
3. **Regras 🟡 Médias** - Recomendadas
4. **Regras 🟢 Baixas** - Opcionais (preferência de equipe)
5. **Solicitação do usuário** - Se usuário pedir explicitamente para violar regra, avise sobre severidade e peça confirmação

## Fluxo de Trabalho Padrão

```
📥 Receber solicitação
    ↓
📂 Ler .rules/ (listar + ler todos os .md)
    ↓
🧠 Identificar regras aplicáveis ao contexto
    ↓
✍️ Escrever código conforme
    ↓
✅ Validar contra critérios objetivos
    ↓
📋 Documentar conformidade na resposta
    ↓
📤 Entregar com checklist de regras seguidas
```

## Exemplo de Resposta Ideal

````markdown
Aqui está a implementação solicitada:

```typescript
// [código]
```

### 📋 Conformidade com Regras

**Regras seguidas**:
- ✅ ESTRUTURAL-001 (Limite de Parâmetros): Função tem 2 parâmetros (limite: 3)
- ✅ COMPORTAMENTAL-005 (Single Responsibility): Classe tem uma única responsabilidade
- ✅ ESTRUTURAL-012 (Complexidade Ciclomática): CC = 4 (limite: 10)

**Validação**:
- Linhas por método: 8-12 (dentro do limite de 15)
- Dependências: 2 (aceitável)
- Cobertura de testes: Necessário adicionar

**Próximos passos**: Adicionar testes unitários conforme COMPORTAMENTAL-008.
````

## Metadados de Regras

Quando mencionar regras, SEMPRE inclua:
- **ID completo**: Ex: ESTRUTURAL-042
- **Nome**: Ex: "Limite de Parâmetros em Construtores"
- **Critério específico**: Ex: "Máximo 3 parâmetros"

Nunca use referências vagas como "a regra de parâmetros" - sempre use o ID.

## Atualização de Regras

Se você detectar que:
- Uma regra está desatualizada
- Falta uma regra importante
- Há conflito entre regras

Informe ao usuário e sugira usar o comando `/rule` para atualizar o repositório.

## Inicialização

Ao iniciar uma conversa neste projeto:

1. Leia automaticamente `.rules/`
2. Construa índice mental de regras por categoria
3. Confirme: "✅ Regras carregadas: [N] regras ([X] Críticas, [Y] Altas, [Z] Médias, [W] Baixas)"
4. Proceda normalmente aplicando as regras

---

**Versão**: 1.0
**Última atualização**: 2025-10-04

Este documento instrui você a seguir rigorosamente o sistema de governança de código do projeto. Violações não justificadas devem ser tratadas como bugs.
